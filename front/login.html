<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous" />
    <link rel="stylesheet" href="css/styleLogin.css" />

    <title>WeControl</title>
  </head>
  <body>
    <div class="container registerBox justify-content-center border border-dark loginDiv">
      <form id="form-login" action="" method="">
        <div id="loginForm" class="loginForm">

        <div class="row">
          <div class="row">
            <div class="form-group col-md-12"></div>
            <img src="img/logo-01.png" class="calcImg" />
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <label for="inputEmail4" class="labels">Username</label>
            <input type="text" class="form-control" name="username"aria-label="Default" aria-describedby="inputGroup-sizing-default">
          </div>
        </div>
        <br>
        <div class="row">
          <div class="col-md-12">
            <label for="inputEmail4" class="labels">Password</label>
            <input type="password" class="form-control" name="password" id="password" />
          </div>
</div>
        

          <div class="row" style="margin-top: 5%">
            <div class="d-flex justify-content-center">
              <button type="submit" class="btn btn-primary btnRegistar">Login</button>
            </div>
          </div>
        </div>
    </div>
  </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/main.js"></script>

<script>


let username;
let identificador;

let form = document.getElementById("form-login");

if (form) {

  form.addEventListener("submit", function () {
    event.preventDefault();
    let formData = new FormData(form);
    let dataJson = {
      username: formData.get("username"),
      password: formData.get("password"),
    };
    let data = JSON.stringify(dataJson);
    axios
      .post("http://localhost:3000/user/login", data, {
        headers: { "Content-Type": "application/json" },
      })
      .then((response) => {
            sessionStorage.setItem("token", "Bearer " + response.data.token);
            sessionStorage.setItem("username", response.data.info.username);
            sessionStorage.setItem("identificador", response.data.info.identificador);
            sessionStorage.setItem("tipo", response.data.info.tipo);
            sessionStorage.setItem("nome", response.data.info.nome);
  
            let dataInfo;
            dataInfo = "O utilizador " + response.data.info.username + " | " + response.data.info.identificador + " fez login.";
            writeLog(dataInfo);
  
            const alert = document.createElement("div");
            alert.classList.add("alert", "alert-success");
            alert.innerText = "Login Efetuado.";
            alert.id = "alert"
            form.prepend(alert);
            setTimeout(function() {
                document.getElementById("alert").remove();
                if(sessionStorage.getItem("tipo") === "admin") {
                  window.location.replace("works.html");
                } else {
                  window.location.replace("worksUser.html");
                }
            }, 1000)
      })
      .catch((error) => {
            const alert = document.createElement("div");
            alert.classList.add("alert", "alert-danger");
            alert.innerText = "Username ou password errados.";
            alert.id = "alert"
            form.prepend(alert);
            setTimeout(function() {
                document.getElementById("alert").remove();
                window.location.replace("login.html");
            }, 1000)
      });
      
  });

}



</script>
  </body>
</html>

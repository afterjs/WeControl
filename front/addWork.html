<!DOCTYPE html>
<html lang="pt">
<head>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">
    <title>WeControl</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animsition/4.0.2/css/animsition.css" rel="stylesheet" media="all">
    <link href="hamburgers/hamburgers.min.css" rel="stylesheet" media="all"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <link href="css/backmain.css" rel="stylesheet" media="all">
    <link href="css/style.css" rel="stylesheet" media="all">
</head>
</head>
<body  class="animsition">
  
  <div class="page-wrapper">
    <!-- MENU TELEMOVEL-->
    <header class="header-mobile d-block d-lg-none">
      <div class="header-mobile__bar">
        <div class="container-fluid">
          <div class="header-mobile-inner">
            <a class="logo menu" data-pagina="" href="#"><img src="img/logo-01.png" id="img-logo" class="img-logo" alt="Cool Admin" style="
              margin-left: auto;
              margin-right: auto;
              display: block;
          "></a>
            <button class="hamburger hamburger--slider" type="button">
              <span class="hamburger-box">
                  <span class="hamburger-inner"></span>
              </span>
             </button>
          </div>
        </div>
      </div>
      <nav class="navbar-mobile">
        <div class="container-fluid">
          <ul class="navbar-mobile__list list-unstyled">
            <li class="has-sub">
              <li>
                <a href="works.html" class="menu"><i class="fas fa-plus"></i>Gerir Trabalhos</a>
              </li>
              <li>
                <a href="users.html" class="menu"><i class="fas fa-plus"></i>Gerir Utilizadores</a>
              </li>
              <li>
                <a href="logs.html" class="menu"><i class="fas fa-id-card"></i>Logs</a>
              </li>
          </li>
            <li>
              <a href="#" onclick="logout()" class="menu"><i class="fas fa-sign-out-alt"></i>Logout</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>



    <aside class="menu-sidebar d-none d-lg-block">
      <div class="logo">
        <a href="users.html" class="menu">
          <img src="img/logo-01.png" id="img-logo" class="img-logo" alt="Cool Admin" style="
          margin-left: auto;
          margin-right: auto;
          display: block;
      ">
      </a>
      </div>
      <div class="menu-sidebar__content js-scrollbar1">
        <nav class="navbar-sidebar">
          <ul class="list-unstyled navbar__list">
         
          
            <li class="has-sub">
              <li>
                <a href="works.html" class="menu"><i class="fas fa-plus"></i>Gerir Trabalhos</a>
              </li>
              <li>
                <a href="users.html" class="menu"><i class="fas fa-plus"></i>Gerir Utilizadores</a>
              </li>
              <li>
                <a href="logs.html" class="menu"><i class="fas fa-id-card"></i>Logs</a>
              </li>
          </li>


          </ul>
        </nav>
      </div>
    </aside>

    <div class="page-container">

      <header class="header-desktop" id="header-desktop">
     

        <div class="section__content section__content--p30">
          <div class="container-fluid">
            <div class="header-wrap">
              <form class="form-header"></form>
              <div class="header-button">
                <div class="account-wrap">
                  <div class="account-item clearfix js-item-menu">
                    <div class="image">
                      <img src="img/logojn.png" alt="Avatar" />
                    </div>
                    <div class="nome-menu">
                      <a>
                       Administração
                      </a>
                    <!-- <i class="fas fa-sms fa-2x" style="color: red;" aria-hidden="true"></i>-->
                      <i class="fas fa-sort-down"></i>
                    </div>
                    <div class="account-dropdown js-dropdown">
                      <div class="info clearfix">
                        <div class="image">
                          <a href="#">
                          <img src="img/logojn.png" alt="John Doe">
                        </a>
                        </div>
                        <div class="content">
                          <h5 class="name">
                            <a href="#">
                              Administração
                            </a>
                          </h5>
                          <span class="email"></span>
                        </div>
                      </div>

                      <div class="account-dropdown__footer">
                       <!-- <div class="account-dropdown__item">
                          <a href="definicoes.php">
                          <i class="zmdi zmdi-settings"></i>Definições</a>
                        </div>-->
                        <a href="#" onclick="logout()">
                            <i class="zmdi zmdi-power"></i>Logout</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
  


      <div class="main-content">
        <div class="section__content section__content--p30">
            <div class="container-fluid">
              <div class="row">
                <div class="col-lg-12">
                  <div class="card">
        
                    <div class="card-body">
                      <div class="card-title">
                        <h3 class="text-center title-2">Adicionar Trabalho</h3>
                      </div>
        
                      <form method="" action="" id="add-work">
                        <p style="float:right">
                          Campos Obrigatorios<span style="color:#e7422d">*</span>
                        </p>
                        <label class="letra-preta" style="border-bottom: 2px solid #e7422d;">Dados Camião</label>
        
                        <div class="form-row">


                          <div class="form-group col-md-4">
                            <label class="letra-preta">Funcionario<span style="color:#e7422d">*</span></label>
                            
                           <select name="selectFunc"  id="selectFunc" class="form-control">                   
                           </select>

                          </div>
        
                          <div class="form-group col-md-4">
                            <label class="letra-preta">Camião<span style="color:#e7422d">*</span></label>
                            <input type="text" class="form-control" name="camiao" id="camiao" placeholder="Scania" required>
                          </div>
                          <div class="form-group col-md-4">
                            <label class="letra-preta">Matirucla<span style="color:#e7422d">*</span></label>
                            <input type="text" class="form-control" name="matricula" id="matricula" placeholder="XXYYZZ" required>
                          </div>
        
                        </div>
        
                        <!------------------------------------------------------------DADOS EMPRESARIAIS---------------------------------------------------------------------------->
        
                        <label class="letra-preta" style="border-bottom: 2px solid #e7422d;  padding-top: 30px;">Rota</label>
        
                        <div class="form-row">
                          <div class="form-group col-md-6">
                            <label class="letra-preta">Doca Inicial<span style="color:#e7422d">*</span></label>
                            <input type="text" class="form-control" name="docaInicial" id="docaInicial" placeholder="Viana" required>
                          </div>
        
                          <div class="form-group col-md-6">
                            <label class="letra-preta">Doca Final<span style="color:#e7422d">*</span></label>
                            <input type="text" class="form-control" name="docaFinal" id="docaFinal" placeholder="Porto" required>
                          </div> 
                        </div>
                        <!------------------------------------------------------------DADOS LOGIN---------------------------------------------------------------------------->
                        <label class="letra-preta" style="border-bottom: 2px solid #e7422d;  padding-top: 30px;">Kilometros/Estado</label>
        
                        <div class="form-row">
                          <div class="form-group col-md-4">
                            <label class="letra-preta">Klm/Inicial<span style="color:#e7422d">*</span></label>
                            <input type="text" class="form-control" name="klmInicial" id="klmInicial" placeholder="2352451.23" required>
                          </div>
        
                          <div class="form-group col-md-4">
                            <label class="letra-preta">Klm/Final</label>
                            <input type="text" class="form-control" name="klmFinal" id="klmFinal" placeholder="3352451.23" >
                          </div>
        
                          <div class="form-group col-md-4">
                            <label class="letra-preta">Estado<span style="color:#e7422d">*</span></label>
                            
                            <select name="estado"  id="estado" class="form-control">                                  
                            <option value="entregue">ENTREGUE</option>    
                            <option value="carregamento">EM CARREGAMENTO</option>  
                            <option value="movimento">MOVIMENTO</option> 
                          </select>
                          </div>
        
                        </div>
                        <div class="form-row">
                          <div class="form-group col-md-12">
        
                            <button id="payment-button" type="submit" class="btn btn-lg buton-sub btn-block" style="width: 20%;"><span id="payment-button-amount">Adicionar Trabalho</span></button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
           </div>
          
            </div>
  


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>            
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animsition/4.0.2/js/animsition.js"></script>
<script src="https://kit.fontawesome.com/ecfbd6ed72.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/i18n/defaults-pt_BR.min.js"></script>
<script src="js/main.js"></script>
<script src="js/apiSend.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>

let headerWeb = document.getElementById("header-desktop");
let addUserForm = document.getElementById("add-work");
let user = sessionStorage.getItem("username");
let id = sessionStorage.getItem("identificador");
let dataInfo;

verificaTipo();
verificaLogin();
getUtilizadores();


  function getUtilizadores() {
     axios.get('http://localhost:3000/user/', {
         headers: {
             //Adicionar a Authorization se for necessário e a API estiver bloqueada pelo middleware
              'Authorization': sessionStorage.getItem("token"),
              'Content-Type': 'application/json'
         },
     })
       .then(response => {         
           $.each(response.data, function(i, u) {
            newOption(u.nome, u.identificador)
           });

       })
       .catch(function (error) {
          
           console.log(error);
       })
       .then(function () {
           // always executed
       });
}

function newOption(name, identificador) {
    let sel = document.getElementById('selectFunc');
    var opt = document.createElement('option');
    opt.append(document.createTextNode(name + " | ID " + identificador));
    opt.value = name;
    opt.id = identificador; 
    sel.append(opt);
}


addUserForm.addEventListener("submit", function () {
    event.preventDefault();
    let formData = new FormData(addUserForm);

    var identificador = $("#selectFunc").children(":selected").attr("id");
    let dataString = {
      "identificador": parseInt(identificador),
      "nome": $("#selectFunc").val(),
      "camiao": formData.get("camiao"),
      "matricula": formData.get("matricula"),
      "docaInicial": formData.get("docaInicial"),
      "docaFinal": formData.get("docaFinal"),
      "klmInicial": formData.get("klmInicial"),
      "klmFinal": formData.get("klmFinal"),
      "estado": $("#estado").val(),
    };
    
    let data = JSON.stringify(dataString);

    console.log(data)

    axios.post("http://localhost:3000/work/addWork", data, {
        headers: { 
          'Authorization': sessionStorage.getItem("token"),
          "Content-Type": "application/json" },
    })

    .then((res) => {

    
      dataInfo = "O admin " + user + " | " + id + " atribuiu um trabalho ao "+ formData.get("nome") +"   [" + formData.get("docaInicial") + " -> " + formData.get("docaFinal") + "]";
      writeLog(dataInfo);

      const alert = document.createElement("div");
      alert.classList.add("alert", "alert-success");
      alert.innerText = "Trabalho Adiconado com Sucesso!";
      alert.id = "alert"
      headerWeb.prepend(alert);
      setTimeout(function() {
          document.getElementById("alert").remove();
          window.location.replace("works.html");
      }, 1500)
    })
    .catch((error) => {
      const alert = document.createElement("div");
          alert.classList.add("alert", "alert-danger");
          alert.innerText = "Ocorreu um erro.";
          alert.id = "alert"
          headerWeb.prepend(alert);
          setTimeout(function() {
              document.getElementById("alert").remove();
              window.location.replace("works.html");
          }, 1500)
    });

  
    

    
});


</script>
</body>


</html>